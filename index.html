<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Діна збирає мушлі</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #101214;
      overflow: hidden;
      touch-action: none;
    }
    body {
      width: 100vw;
      height: 100vh;
      overscroll-behavior: contain;
    }
    #gameCanvas {
      display: block;
      margin: 0 auto;
      background: #222;
      width: 100vw;
      height: 100vh;
      max-width: 100vw;
      max-height: 100vh;
      position: absolute;
      left: 0; top: 0;
      z-index: 0;
      touch-action: none;
    }
    .hud {
      position: absolute;
      z-index: 2;
      color: #F6FFD2;
      font-family: 'Arial Black', Arial, sans-serif;
      font-weight: bold;
      font-size: 1.25em;
      text-shadow: 2px 2px 8px #000;
      user-select: none;
      pointer-events: none;
    }
    #hud-level {
      left: 16px; top: 12px; text-align: left;
    }
    #hud-score {
      right: 16px; top: 12px; text-align: right;
    }
    #hud-timer {
      left: 14px; bottom: 95px; display: flex; align-items: center;
      background: rgba(0,0,0,0.05); border-radius: 8px; padding: 2px 8px;
      font-size: 1.2em;
    }
    #hud-timer img { width: 28px; margin-right: 6px; }
    #soundBtn {
      position: absolute; right: 14px; top: 14px; z-index: 4;
      width: 42px; height: 42px; background: transparent; border: none; padding: 0; cursor: pointer;
    }
    #soundBtn img { width: 100%; }
    .controls {
      position: absolute; left: 50%; bottom: 36px; z-index: 10;
      transform: translateX(-50%);
      display: flex; flex-direction: row; justify-content: center; align-items: center;
      gap: 14px;
      user-select: none;
      pointer-events: auto;
    }
    .ctrl-btn {
      width: 82px; height: 82px;
      border-radius: 50%;
      background: rgba(16, 16, 16, 0.8);
      border: none;
      outline: none;
      box-shadow: 0 3px 18px 0 rgba(0,0,0,0.25);
      display: flex; align-items: center; justify-content: center;
      padding: 0;
      margin: 0 2px;
      cursor: pointer;
      touch-action: none;
      transition: background 0.15s;
      z-index: 11;
    }
    .ctrl-btn img { width: 56px; height: 56px; }
    .ctrl-center { position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%); }
    .ctrl-up    { position: absolute; left: 50%; top: 0;    transform: translate(-50%,0); }
    .ctrl-down  { position: absolute; left: 50%; bottom: 0; transform: translate(-50%,0);}
    .ctrl-left  { position: absolute; left: 0; top: 50%;    transform: translate(0,-50%);}
    .ctrl-right { position: absolute; right: 0; top: 50%;   transform: translate(0,-50%);}
    .ctrl-panel {
      position: relative; width: 230px; height: 230px; margin: 0 auto;
      margin-bottom: 0;
    }
    @media (min-width: 800px) {
      .controls { bottom: 48px; }
      #hud-timer { bottom: 110px;}
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="405" height="720"></canvas>
  <!-- HUD -->
  <div id="hud-level" class="hud" style="top:14px;left:14px"></div>
  <div id="hud-score" class="hud" style="top:14px;right:14px"></div>
  <div id="hud-timer" class="hud"><img src="icons/hourglass.png" alt="Timer"/><span id="timerText"></span></div>
  <!-- Звук -->
  <button id="soundBtn"><img id="soundIcon" src="icons/sound-on.png" alt="sound"></button>
  <!-- Управління -->
  <div class="controls">
    <div class="ctrl-panel">
      <button class="ctrl-btn ctrl-up"    id="btn-up"><img src="icons/up.png" /></button>
      <button class="ctrl-btn ctrl-down"  id="btn-down"><img src="icons/down.png" /></button>
      <button class="ctrl-btn ctrl-left"  id="btn-left"><img src="icons/left.png" /></button>
      <button class="ctrl-btn ctrl-right" id="btn-right"><img src="icons/right.png" /></button>
    </div>
  </div>
  <audio id="bgMusic" src="music/yachting-song.MP3" loop preload="auto"></audio>
  <script>
    // --- CONFIG ---
    const CANVAS_W = 405, CANVAS_H = 720;  // 9:16 мобільний
    const DINA_SIZE = 85, SHELL_SIZE = 55, YACHT_W = 92, YACHT_H = 60;
    const DINA_MAX_SCALE = 3.0;
    // --- LOAD IMAGES ---
    function loadImg(src) { let i=new Image(); i.src=src; return i;}
    const bg = loadImg("backgrounds/bg4.jpg");
    const dinaImg = loadImg("icons/dina.png");
    const shellImg = loadImg("icons/shell.png");
    const yachtImg = loadImg("yachts/yacht.png");
    // --- SOUND BUTTON ---
    const soundBtn = document.getElementById("soundBtn");
    const soundIcon = document.getElementById("soundIcon");
    const bgMusic = document.getElementById("bgMusic");
    let musicOn = true;
    function setMusic(on) {
      musicOn = on;
      bgMusic.volume = on ? 0.6 : 0;
      soundIcon.src = on ? "icons/sound-on.png" : "icons/sound-off.png";
      if(on) { bgMusic.play().catch(()=>{}); } else { bgMusic.pause(); }
    }
    soundBtn.onclick = () => setMusic(!musicOn);
    // Автовідтворення на мобільних при першому дотику
    document.body.addEventListener('touchstart', ()=>{ if(musicOn) bgMusic.play().catch(()=>{}); }, {once:true});
    // --- GAME STATE ---
    let dina = {x:CANVAS_W/2, y:CANVAS_H*0.65, scale:1.0};
    let shells = [];
    let yacht = {x:CANVAS_W/2, y:CANVAS_H/5};
    let level = 1, score = 0, timer = 40, gameActive = true;
    let shellCollected = 0;
    // --- INIT OBJECTS ---
    function placeShell() {
      let margin = 42;
      let x = margin + Math.random()*(CANVAS_W-2*margin);
      let y = margin + Math.random()*(CANVAS_H-180-2*margin)+90;
      shells.push({x,y});
    }
    function placeYacht() {
      yacht.x = Math.random()*(CANVAS_W-YACHT_W/2) + YACHT_W/2;
      yacht.y = 55 + Math.random()*80;
    }
    function resetGame() {
      level = 1; score = 0; timer = 40; dina.scale = 1.0; gameActive = true; shells = []; shellCollected=0;
      dina.x = CANVAS_W/2; dina.y = CANVAS_H*0.65;
      placeShell();
      placeYacht();
      setMusic(true);
    }
    // --- DRAW ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(bg,0,0,canvas.width,canvas.height);
      // Яхта
      ctx.drawImage(yachtImg, yacht.x-YACHT_W/2, yacht.y-YACHT_H/2, YACHT_W, YACHT_H);
      // Мушлі
      shells.forEach(s=>ctx.drawImage(shellImg,s.x-SHELL_SIZE/2,s.y-SHELL_SIZE/2,SHELL_SIZE,SHELL_SIZE));
      // Діна
      let dinaW = DINA_SIZE*dina.scale, dinaH = DINA_SIZE*dina.scale*1.15;
      ctx.drawImage(dinaImg,dina.x-dinaW/2,dina.y-dinaH/2,dinaW,dinaH);
    }
    // --- HUD ---
    function updateHUD() {
      document.getElementById("hud-level").textContent = "Рівень: " + level;
      document.getElementById("hud-score").textContent = "Бонуси: " + score;
      document.getElementById("timerText").textContent = ("0"+timer).slice(-2);
    }
    // --- LOGIC & LOOP ---
    function dist(a,b){let dx=a.x-b.x,dy=a.y-b.y; return Math.sqrt(dx*dx+dy*dy);}
    function nextLevel() {
      level++; timer = Math.max(20, 40-Math.floor(level*2.1)); dina.scale=1.0; shells=[]; shellCollected=0;
      placeShell(); placeYacht();
    }
    function gameLoop() {
      if(!gameActive) return;
      // Move yacht (лево-право)
      yacht.x += Math.sin(Date.now()/1400)*0.24;
      draw();
      updateHUD();
      // Діна збирає мушлю
      shells.forEach((shell,idx)=>{
        if(dist(dina,shell)<48*dina.scale){
          shells.splice(idx,1);
          score += 15+level*5;
          dina.scale = Math.min(dina.scale+0.24, DINA_MAX_SCALE);
          shellCollected++;
          placeShell();
          if(shellCollected>=5) nextLevel();
        }
      });
      // Кінець таймера — новий рівень
      if(timer<=0) { nextLevel(); }
      requestAnimationFrame(gameLoop);
    }
    // --- TIMER ---
    setInterval(()=>{
      if(gameActive && timer>0){ timer--; updateHUD(); }
    },1000);
    // --- CONTROLS ---
    function moveDina(dx,dy){
      let spd = 18-(level*1.5); // З кожним рівнем швидше
      spd = Math.max(6, spd);
      dina.x = Math.max(DINA_SIZE*dina.scale/2, Math.min(CANVAS_W-DINA_SIZE*dina.scale/2, dina.x+dx*spd));
      dina.y = Math.max(DINA_SIZE*dina.scale/2, Math.min(CANVAS_H-DINA_SIZE*dina.scale/2, dina.y+dy*spd));
    }
    document.getElementById("btn-up").ontouchstart = ()=>moveDina(0,-1);
    document.getElementById("btn-down").ontouchstart = ()=>moveDina(0,1);
    document.getElementById("btn-left").ontouchstart = ()=>moveDina(-1,0);
    document.getElementById("btn-right").ontouchstart = ()=>moveDina(1,0);
    // клавіатура
    window.addEventListener('keydown', e=>{
      if(e.key=="ArrowUp") moveDina(0,-1);
      if(e.key=="ArrowDown") moveDina(0,1);
      if(e.key=="ArrowLeft") moveDina(-1,0);
      if(e.key=="ArrowRight") moveDina(1,0);
    });
    // --- START ---
    window.onload = ()=>{
      canvas.width = CANVAS_W; canvas.height = CANVAS_H;
      resetGame(); updateHUD();
      setTimeout(gameLoop, 200);
    }
  </script>
</body>
</html>
