<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Діна збирає мушлі</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100vw; height: 100vh;
      overflow: hidden;
      background: #111;
      touch-action: none;
    }
    #gameCanvas {
      display: block;
      margin: 0 auto;
      background: #000;
      border-radius: 16px;
      box-shadow: 0 2px 24px #0008;
      touch-action: none;
      width: 100vw;
      height: 100vh;
      max-width: 100vw;
      max-height: 100vh;
      object-fit: contain;
      background-size: cover;
    }
    .sound-btn {
      position: fixed;
      top: 18px; right: 18px;
      width: 52px; height: 52px;
      z-index: 2;
      opacity: 0.85;
    }
    .ui-top {
      position: absolute;
      width: 100vw;
      top: 0; left: 0;
      display: flex; justify-content: space-between;
      padding: 18px 16px 0 16px;
      font-family: Segoe UI, Arial, sans-serif;
      font-size: 24px; color: #fffdbe;
      font-weight: 700;
      text-shadow: 2px 2px 4px #000a;
      pointer-events: none;
      z-index: 1;
    }
    .ui-corner {
      position: absolute;
      left: 16px; bottom: 112px;
      display: flex; align-items: center;
      font-size: 28px; color: #fffdbe; font-weight: 700;
      text-shadow: 2px 2px 4px #000a;
      pointer-events: none;
      z-index: 1;
    }
    .ui-corner img { height: 36px; margin-right: 10px; }
    .control-btns {
      position: fixed;
      bottom: 34px; left: 0; width: 100vw;
      display: flex; flex-direction: row;
      justify-content: center; align-items: flex-end;
      z-index: 2;
      pointer-events: none;
    }
    .arrows-outer {
      width: 310px; height: 110px;
      display: flex; flex-direction: row; justify-content: space-between; align-items: flex-end;
      margin: 0 auto;
      pointer-events: none;
    }
    .arrow-btn {
      width: 80px; height: 80px;
      border-radius: 40px;
      margin: 0 6px;
      background: #000a;
      display: flex; align-items: center; justify-content: center;
      pointer-events: all;
      border: none;
      outline: none;
      transition: background 0.2s;
      box-shadow: 0 2px 12px #0009;
    }
    .arrow-btn img { width: 52px; height: 52px; user-select: none; pointer-events: none; }
    .arrow-btn:active { background: #44e4ffaa; }
    @media (max-width: 450px) {
      .ui-top { font-size: 17px; }
      .ui-corner { font-size: 20px; }
      .sound-btn { width: 40px; height: 40px; top: 10px; right: 10px;}
      .control-btns { bottom: 12px; }
      .arrows-outer { width: 230px; height: 85px;}
      .arrow-btn { width: 56px; height: 56px;}
      .arrow-btn img { width: 35px; height: 35px;}
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="405" height="720"></canvas>

  <!-- UI -->
  <div class="ui-top" id="uiTop">
    <div>
      <img src="icons/shell.png" style="height:28px; vertical-align: middle;">
      <span id="scoreTxt">0</span>
    </div>
    <div>
      <img src="icons/dina.png" style="height:26px;vertical-align: middle;">
      <span id="levelTxt">1</span>
    </div>
  </div>
  <div class="ui-corner">
    <img src="icons/hourglass.png">
    <span id="timerTxt">00:30</span>
  </div>
  <button class="sound-btn" id="soundBtn" tabindex="-1" aria-label="Увімкнути/Вимкнути звук">
    <img id="soundIcon" src="icons/sound-on.png" width="48" height="48">
  </button>

  <div class="control-btns">
    <div class="arrows-outer">
      <button class="arrow-btn" id="leftBtn"><img src="icons/left.png" alt="Вліво"></button>
      <button class="arrow-btn" id="upBtn"><img src="icons/up.png" alt="Вгору"></button>
      <button class="arrow-btn" id="downBtn"><img src="icons/down.png" alt="Вниз"></button>
      <button class="arrow-btn" id="rightBtn"><img src="icons/right.png" alt="Вправо"></button>
    </div>
  </div>

  <audio id="music" src="music/yachting-song.MP3" loop></audio>

<script>
const CANVAS_WIDTH = 405;
const CANVAS_HEIGHT = 720;
const BG_IMG = "backgrounds/bg4.jpg"; // заміни на актуальний фон!
const YACHT_IMG = "yachts/yacht.png";
const DINA_IMG = "icons/dina.png";
const SHELL_IMG = "icons/shell.png";

const LEFT_IMG = "icons/left.png";
const RIGHT_IMG = "icons/right.png";
const UP_IMG = "icons/up.png";
const DOWN_IMG = "icons/down.png";
const HOURGLASS_IMG = "icons/hourglass.png";
const SOUND_ON_IMG = "icons/sound-on.png";
const SOUND_OFF_IMG = "icons/sound-off.png";

const music = document.getElementById("music");

let ctx, W, H;
let bg, dina, shell, yacht;

let dinaPos = {x: CANVAS_WIDTH/2, y: CANVAS_HEIGHT/2};
let dinaSize = 70, dinaMaxSize = 190;
let yachtPos = {x: 80, y: 130};
let yachtW = 70, yachtH = 70;
let shellPos = {x: 320, y: 300};
let shellW = 48, shellH = 48;

let score = 0, level = 1, timeLeft = 30, timerInterval;
let direction = {x:0, y:0};
let gameOver = false;
let soundOn = true;

function loadImg(src) {
  const img = new Image();
  img.src = src;
  return img;
}
function clamp(val, min, max) { return Math.max(min, Math.min(max, val)); }
function randomPos() {
  // Враховує розміри canvas, щоб об'єкти не з'являлись за межами
  return {
    x: Math.floor(60 + Math.random() * (CANVAS_WIDTH - 120)),
    y: Math.floor(110 + Math.random() * (CANVAS_HEIGHT - 240))
  }
}

function drawGame() {
  ctx.clearRect(0, 0, W, H);
  // Background
  ctx.drawImage(bg, 0, 0, W, H);
  // Яхта
  ctx.drawImage(yacht, yachtPos.x, yachtPos.y, yachtW, yachtH);
  // Shell
  ctx.drawImage(shell, shellPos.x, shellPos.y, shellW, shellH);
  // Діна
  ctx.drawImage(dina, dinaPos.x, dinaPos.y, dinaSize, dinaSize);

  // Нічого тут більше не малюємо: UI-елементи через HTML, не на canvas
}

function updateGame() {
  if (gameOver) return;

  // Діна рухається по direction
  let speed = 2.2 + Math.min(level*0.4, 4); // початково повільніше, потім швидше
  dinaPos.x += direction.x * speed;
  dinaPos.y += direction.y * speed;

  dinaPos.x = clamp(dinaPos.x, 0, W-dinaSize);
  dinaPos.y = clamp(dinaPos.y, 0, H-dinaSize);

  // Зіткнення з мушлею
  if (Math.abs(dinaPos.x - shellPos.x) < dinaSize-15 && Math.abs(dinaPos.y - shellPos.y) < dinaSize-15) {
    score += 10;
    shellPos = randomPos();
    dinaSize = clamp(dinaSize * 1.15, 70, dinaMaxSize); // збільшення до 3 разів
    updateUI();
  }

  // Зіткнення з яхтою
  if (Math.abs(dinaPos.x - yachtPos.x) < dinaSize-20 && Math.abs(dinaPos.y - yachtPos.y) < dinaSize-20) {
    score += 20;
    yachtPos = randomPos();
    updateUI();
  }

  drawGame();
  requestAnimationFrame(updateGame);
}

function updateUI() {
  document.getElementById("scoreTxt").textContent = score;
  document.getElementById("levelTxt").textContent = level;
  let min = Math.floor(timeLeft/60), sec = timeLeft%60;
  document.getElementById("timerTxt").textContent = (min>0? (min+":") :"") + (sec<10?"0":"") + sec;
}
function startGame() {
  gameOver = false;
  score = 0; level = 1; timeLeft = 30; dinaSize = 70;
  dinaPos = {x: CANVAS_WIDTH/2, y: CANVAS_HEIGHT/2};
  yachtPos = randomPos();
  shellPos = randomPos();
  updateUI();
  if (timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    if (timeLeft>0) { timeLeft--; updateUI(); }
    else { clearInterval(timerInterval); gameOver = true; }
  }, 1000);
  requestAnimationFrame(updateGame);
}
function setDirection(dx,dy) { direction.x=dx; direction.y=dy; }
function stopDirection() { direction.x=0; direction.y=0; }

// Управління стрілками (екран)
document.getElementById("leftBtn").ontouchstart = e => { setDirection(-1,0); e.preventDefault();}
document.getElementById("rightBtn").ontouchstart = e => { setDirection(1,0); e.preventDefault();}
document.getElementById("upBtn").ontouchstart = e => { setDirection(0,-1); e.preventDefault();}
document.getElementById("downBtn").ontouchstart = e => { setDirection(0,1); e.preventDefault();}

["leftBtn","rightBtn","upBtn","downBtn"].forEach(id=>{
  document.getElementById(id).ontouchend = e => { stopDirection(); }
});

// Управління стрілками (миша)
document.getElementById("leftBtn").onmousedown = e => { setDirection(-1,0);}
document.getElementById("rightBtn").onmousedown = e => { setDirection(1,0);}
document.getElementById("upBtn").onmousedown = e => { setDirection(0,-1);}
document.getElementById("downBtn").onmousedown = e => { setDirection(0,1);}
["leftBtn","rightBtn","upBtn","downBtn"].forEach(id=>{
  document.getElementById(id).onmouseup = e => { stopDirection(); }
  document.getElementById(id).onmouseleave = e => { stopDirection(); }
});

// Клавіатура (PC)
window.addEventListener("keydown", e=>{
  if(e.repeat) return;
  if (e.key=="ArrowLeft") setDirection(-1,0);
  if (e.key=="ArrowRight") setDirection(1,0);
  if (e.key=="ArrowUp") setDirection(0,-1);
  if (e.key=="ArrowDown") setDirection(0,1);
});
window.addEventListener("keyup", e=>{
  stopDirection();
});

// Звук
document.getElementById("soundBtn").onclick = ()=>{
  soundOn = !soundOn;
  document.getElementById("soundIcon").src = soundOn? SOUND_ON_IMG : SOUND_OFF_IMG;
  music.volume = soundOn?1:0;
};
music.volume = 1;

window.onload = function() {
  W = CANVAS_WIDTH; H = CANVAS_HEIGHT;
  ctx = document.getElementById("gameCanvas").getContext("2d");
  // Завантаження всіх картинок
  bg = loadImg(BG_IMG);
  yacht = loadImg(YACHT_IMG);
  dina = loadImg(DINA_IMG);
  shell = loadImg(SHELL_IMG);
  // Збільшити canvas до ширини вікна
  document.getElementById("gameCanvas").width = window.innerWidth;
  document.getElementById("gameCanvas").height = window.innerHeight;
  W = document.getElementById("gameCanvas").width;
  H = document.getElementById("gameCanvas").height;
  setTimeout(()=>{ startGame(); }, 400);
  // Автовідтворення музики на мобільному
  document.body.addEventListener('touchstart', function(){ music.play(); }, {once:true});
  document.body.addEventListener('mousedown', function(){ music.play(); }, {once:true});
};
</script>
</body>
</html>
