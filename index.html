<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Діна збирає мушлі</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover">
  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100vw; height: 100vh;
      background: #000;
      overflow: hidden;
      touch-action: none;
    }
    body { position: relative; width: 100vw; height: 100vh; }
    #gameCanvas {
      display: block;
      position: absolute;
      left: 50%; top: 50%;
      transform: translate(-50%,-50%);
      background: #000;
      z-index: 1;
      /* Адаптація 9:16 */
      width: 100vw;
      height: 100vh;
      max-width: 100vw;
      max-height: 100vh;
      aspect-ratio: 9/16;
      touch-action: none;
    }
    #hud {
      position: fixed;
      top: 0; left: 0; right: 0;
      width: 100vw;
      height: 48px;
      z-index: 10;
      background: rgba(0,0,0,0.32);
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-family: Arial,sans-serif;
      font-size: 20px;
      color: #fff;
      text-shadow: 1px 1px 2px #000,0 0 4px #000;
      pointer-events: none;
      padding: 2px 12px;
      box-sizing: border-box;
    }
    #hud .hud-group { display: flex; align-items: center; gap: 9px; }
    #hud .hud-icon { width: 29px; height: 29px; margin-right: 2px; }
    #hud #hud-sound {
      width: 30px; height: 30px; margin-left: 14px;
      filter: drop-shadow(1px 1px 3px #000);
      pointer-events: auto; cursor: pointer;
    }
    #hud-level { font-weight: bold; margin-left: 9px;}
    /* --- Кнопки керування --- */
    #controls {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      width: 100vw;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      z-index: 11;
      gap: 2vw;
      padding-bottom: env(safe-area-inset-bottom, 4vw);
      pointer-events: none;
      user-select: none;
    }
    .ctrl-btn {
      width: 16vw; height: 16vw; max-width: 64px; max-height: 64px;
      border: none; background: rgba(40,60,120,0.35);
      border-radius: 11px;
      margin: 0 1vw;
      display: flex; align-items: center; justify-content: center;
      opacity: 0.85;
      pointer-events: auto;
      transition: background .15s;
      box-shadow: 0 1px 6px 0 #222a;
    }
    .ctrl-btn img { width: 80%; height: 80%; }
    .ctrl-btn:active { background: #6bf3; opacity: 1; }
    @media (min-width: 600px) {
      #gameCanvas { width: 420px; height: 750px; }
      #hud, #controls { max-width: 420px; left: 50%; transform: translateX(-50%); }
    }
    @media (pointer: fine) {
      #controls { display: none !important; }
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="360" height="640"></canvas>
  <div id="hud">
    <span class="hud-group">
      <img src="icons/shell.png" class="hud-icon" alt=""><span id="scoreText">0</span>
    </span>
    <span class="hud-group">
      <img src="icons/hourglass.png" class="hud-icon" alt=""><span id="timeText">60</span>
    </span>
    <span class="hud-group">
      <span>Рівень:</span> <span id="hud-level">1</span>
    </span>
    <img id="hud-sound" src="icons/sound-on.png" alt="sound">
  </div>
  <div id="controls">
    <button class="ctrl-btn" id="btnLeft"><img src="icons/left.png"></button>
    <button class="ctrl-btn" id="btnUp"><img src="icons/up.png"></button>
    <button class="ctrl-btn" id="btnDown"><img src="icons/down.png"></button>
    <button class="ctrl-btn" id="btnRight"><img src="icons/right.png"></button>
  </div>
  <audio id="bgMusic" src="music/yachting-song.MP3" loop></audio>
  <script>
    // --- Canvas адаптація під екран ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    function resizeCanvas() {
      let w = window.innerWidth, h = window.innerHeight;
      const aspect = 9/16;
      if (w/h > aspect) w = h*aspect; else h = w/aspect;
      canvas.width = w; canvas.height = h;
      canvas.style.width = w+"px"; canvas.style.height = h+"px";
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // --- Завантаження зображень ---
    const backgrounds = [];
    for (let i=1; i<=6; ++i) {
      const img = new Image();
      img.src = `backgrounds/bg${i}.jpg`;
      backgrounds.push(img);
    }
    const dinaImg = new Image(); dinaImg.src = "icons/dina.png";
    const yachtImg = new Image(); yachtImg.src = "yachts/yacht1.png";
    const shellImg = new Image(); shellImg.src = "icons/shell.png";

    // --- Основні змінні ---
    let level = 1, score = 0, time = 60, playing = true;
    let shell = { x: 0, y: 0, size: 0 };
    let dina = { x: 0, y: 0, size: 0, baseSize: 0, maxSize: 0 };
    let yacht = { x: 0, y: 0, size: 0, speed: 0 };
    let move = { left: false, right: false, up: false, down: false };
    let timerId;

    // --- Звук ---
    const music = document.getElementById('bgMusic');
    let soundOn = true;
    document.getElementById('hud-sound').onclick = function() {
      soundOn = !soundOn;
      this.src = soundOn ? "icons/sound-on.png" : "icons/sound-off.png";
      if (soundOn) music.play().catch(()=>{}); else music.pause();
    };

    // --- Керування ---
    function setMove(dir, state) { move[dir] = state; }
    document.getElementById('btnLeft').ontouchstart = ()=>setMove('left', true);
    document.getElementById('btnLeft').ontouchend = ()=>setMove('left', false);
    document.getElementById('btnRight').ontouchstart = ()=>setMove('right', true);
    document.getElementById('btnRight').ontouchend = ()=>setMove('right', false);
    document.getElementById('btnUp').ontouchstart = ()=>setMove('up', true);
    document.getElementById('btnUp').ontouchend = ()=>setMove('up', false);
    document.getElementById('btnDown').ontouchstart = ()=>setMove('down', true);
    document.getElementById('btnDown').ontouchend = ()=>setMove('down', false);

    window.addEventListener('keydown', e => {
      if (e.key==="ArrowLeft") move.left = true;
      if (e.key==="ArrowRight") move.right = true;
      if (e.key==="ArrowUp") move.up = true;
      if (e.key==="ArrowDown") move.down = true;
      if (soundOn && music.paused) music.play().catch(()=>{});
    });
    window.addEventListener('keyup', e => {
      if (e.key==="ArrowLeft") move.left = false;
      if (e.key==="ArrowRight") move.right = false;
      if (e.key==="ArrowUp") move.up = false;
      if (e.key==="ArrowDown") move.down = false;
    });

    // --- Головна ініціалізація гри ---
    function initGame() {
      resizeCanvas();
      playing = true; score = 0; level = 1; time = 60;
      setParamsByLevel();
      document.getElementById('scoreText').textContent = score;
      document.getElementById('timeText').textContent = time;
      document.getElementById('hud-level').textContent = level;
      dina.x = canvas.width/2-dina.size/2;
      dina.y = canvas.height-dina.size-16;
      yacht.x = canvas.width/2-yacht.size/2;
      yacht.y = 10;
      spawnShell();
      if (timerId) clearInterval(timerId);
      timerId = setInterval(()=>{
        if (!playing) return;
        time--;
        document.getElementById('timeText').textContent = time;
        if (time <= 0) {
          playing = false; music.pause();
          setTimeout(()=>{ alert(`Час вийшов! Рахунок: ${score}`); initGame(); }, 400);
        }
      },1000);
      if (soundOn) music.play().catch(()=>{});
      requestAnimationFrame(gameLoop);
    }
    function setParamsByLevel() {
      dina.baseSize = canvas.height*0.11;
      dina.maxSize = dina.baseSize*3;
      dina.size = dina.baseSize;
      yacht.size = canvas.height*0.13;
      shell.size = canvas.height*0.07;
      dina.speed = canvas.height/110;
      const base = [0.23, 0.32, 0.43, 0.55, 0.7, 0.9];
      yacht.speed = dina.speed * base[level-1];
    }
    function spawnShell() {
      const m = shell.size+10;
      shell.x = m + Math.random()*(canvas.width-2*m);
      shell.y = m + Math.random()*(canvas.height-2*m);
    }
    function nextLevel() {
      if (level < 6) { level++; setParamsByLevel(); }
      document.getElementById('hud-level').textContent = level;
    }
    // --- Основний цикл гри ---
    function gameLoop() {
      // --- Оновлення положення Діни ---
      if (move.left) dina.x -= dina.speed;
      if (move.right) dina.x += dina.speed;
      if (move.up) dina.y -= dina.speed;
      if (move.down) dina.y += dina.speed;
      dina.x = Math.max(0, Math.min(canvas.width-dina.size, dina.x));
      dina.y = Math.max(0, Math.min(canvas.height-dina.size, dina.y));
      // --- Оновлення яхти ---
      let dx = (shell.x+shell.size/2)-(yacht.x+yacht.size/2);
      let dy = (shell.y+shell.size/2)-(yacht.y+yacht.size/2);
      let dist = Math.sqrt(dx*dx+dy*dy);
      if (dist>2) {
        let speed = yacht.speed;
        if (time<=10) speed *= 1.5; // останні 10 сек прискорення
        yacht.x += dx/dist*speed;
        yacht.y += dy/dist*speed;
      }
      // --- Перевірка збору мушлі ---
      let dinaDist = Math.hypot((dina.x+dina.size/2)-(shell.x+shell.size/2), (dina.y+dina.size/2)-(shell.y+shell.size/2));
      let yachtDist = Math.hypot((yacht.x+yacht.size/2)-(shell.x+shell.size/2), (yacht.y+yacht.size/2)-(shell.y+shell.size/2));
      let collected = false;
      if (dinaDist < (dina.size+shell.size)*0.37) {
        score++;
        document.getElementById('scoreText').textContent = score;
        // **Збільшуємо розмір Діни кожного разу, але не більше 3x**
        dina.size = Math.min(dina.size * 1.1, dina.maxSize);
        if (score % 5 === 0 && level < 6) {
          nextLevel();
        }
        collected = true;
      } else if (yachtDist < (yacht.size+shell.size)*0.38) {
        collected = true;
      }
      if (collected) spawnShell();

      // --- Малювання ---
      ctx.clearRect(0,0,canvas.width,canvas.height);
      let bg = backgrounds[level-1];
      if (bg.complete) ctx.drawImage(bg,0,0,canvas.width,canvas.height);
      ctx.drawImage(shellImg, shell.x, shell.y, shell.size, shell.size);
      ctx.drawImage(yachtImg, yacht.x, yacht.y, yacht.size, yacht.size);
      ctx.drawImage(dinaImg, dina.x, dina.y, dina.size, dina.size);

      if (playing) requestAnimationFrame(gameLoop);
    }
    // --- Автоадаптація canvas при старті та ресайзі ---
    window.addEventListener('resize', ()=>{
      resizeCanvas(); setParamsByLevel();
    });
    // --- Старт гри ---
    window.onload = ()=>{ setTimeout(initGame, 200); };
  </script>
</body>
</html>
