<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–î—ñ–Ω–∞ –∑–±–∏—Ä–∞—î –º—É—à–ª—ñ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #131313;
    }
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
    }
    .game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      max-width: 430px;   /* iPhone 14 Pro max-width */
      max-height: 900px;  /* –ü—ñ–¥ —Ñ–æ—Ä–º–∞—Ç 9:16 */
      background: #000;
      overflow: hidden;
    }
    #game-canvas {
      width: 100vw;
      height: 100vh;
      max-width: 430px;
      max-height: 900px;
      display: block;
      background: #000;
    }
    .score, .level, .timer {
      position: absolute;
      color: #b0ffb7;
      font-size: 1.2em;
      text-shadow: 0 0 4px #000, 0 0 8px #000;
      z-index: 10;
      pointer-events: none;
      user-select: none;
    }
    .score { top: 8px; left: 12px; }
    .level { top: 8px; right: 12px; }
    .timer { bottom: 8px; left: 12px; }
    .mute-btn {
      position: absolute;
      bottom: 8px;
      right: 12px;
      background: #111a;
      border: none;
      border-radius: 50%;
      width: 44px; height: 44px;
      color: #fff;
      font-size: 1.7em;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 20;
      cursor: pointer;
    }
    .controls {
      position: absolute;
      bottom: 35px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 30;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      user-select: none;
    }
    .row {
      display: flex;
      flex-direction: row;
      gap: 12px;
      justify-content: center;
    }
    .arrow-btn {
      background: #18191aee;
      border: none;
      border-radius: 50%;
      width: 56px; height: 56px;
      color: #b0ffb7;
      font-size: 2.3em;
      box-shadow: 0 0 8px #222;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      outline: none;
      transition: background 0.15s;
    }
    .arrow-btn:active {
      background: #2a4630;
    }
    @media (max-width: 430px), (max-height: 900px) {
      .game-container, #game-canvas {
        max-width: 100vw;
        max-height: 100vh;
      }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <canvas id="game-canvas" width="360" height="640"></canvas>
    <div class="score">–ë–æ–Ω—É—Å–∏: <span id="score">0</span></div>
    <div class="level">–†—ñ–≤–µ–Ω—å: <span id="level">1</span></div>
    <div class="timer">‚è≥ <span id="timer">01:00</span></div>
    <button class="mute-btn" id="mute-btn" title="–£–≤—ñ–º–∫–Ω—É—Ç–∏/–í–∏–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫">üîä</button>
    <div class="controls">
      <div class="row">
        <button class="arrow-btn" id="btn-up">‚ñ≤</button>
      </div>
      <div class="row">
        <button class="arrow-btn" id="btn-left">‚óÄ</button>
        <button class="arrow-btn" id="btn-down">‚ñº</button>
        <button class="arrow-btn" id="btn-right">‚ñ∂</button>
      </div>
    </div>
    <audio id="bg-music" src="music/yachting-song.MP3" loop></audio>
  </div>
  <script>
    // --- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ---
    const CANVAS_W = 360, CANVAS_H = 640; // 9:16
    const PLAYER_W = 80, PLAYER_H = 48;
    const SHELL_W = 42, SHELL_H = 42;
    const MOVE_STEP = 16;
    const LEVEL_TIME = 60; // —Å–µ–∫
    const PLAYER_MAX_SCALE = 3;

    const backgrounds = [
      'backgrounds/bg1.jpg','backgrounds/bg2.jpg',
      'backgrounds/bg3.jpg','backgrounds/bg4.jpg',
      'backgrounds/bg5.jpg','backgrounds/bg6.jpg'
    ];
    let level = 1, totalLevels = backgrounds.length;
    let score = 0, timeLeft = LEVEL_TIME, timerId = null, gameOver = false;

    const bg = new Image();
    const dina = new Image();
    const shell = new Image();
    const yacht = new Image();
    dina.src = 'icons/dina.png';
    shell.src = 'icons/shell.png';
    yacht.src = 'yachts/yacht1.png';

    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');

    let player = {x: CANVAS_W/2-PLAYER_W/2, y: CANVAS_H/2-PLAYER_H/2};
    let shellPos = randomShell();
    let shellAnim = {scale: 1, fade: 1, show: true};
    let yachtPos = {x: Math.random()*(CANVAS_W-90), y: Math.random()*(CANVAS_H-110)};
    let yachtSpeed = 1.0; // —Å–ø–æ—á–∞—Ç–∫—É –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ

    // --- –ú—É–∑–∏–∫–∞ ---
    const music = document.getElementById('bg-music');
    let muted = false;
    document.getElementById('mute-btn').onclick = function() {
      muted = !muted;
      music.muted = muted;
      this.innerText = muted ? 'üîá' : 'üîä';
      if (!music.paused && !muted) music.play();
    };
    window.addEventListener('keydown', () => {
      if (music.paused && !muted) music.play();
    }, {once:true});

    // --- –¢–∞–π–º–µ—Ä ---
    function startTimer() {
      clearInterval(timerId);
      timerId = setInterval(()=>{
        if (--timeLeft<=0) {
          timeLeft = 0;
          level++;
          if (level <= totalLevels) {
            setLevel(level);
            shellPos = randomShell();
            player = {x: CANVAS_W/2-PLAYER_W/2, y: CANVAS_H/2-PLAYER_H/2};
            shellAnim = {scale:1, fade:1, show:true};
            draw();
          } else {
            gameOver = true;
            clearInterval(timerId);
          }
        }
        updateTimer();
      }, 1000);
    }
    function updateTimer() {
      let min = Math.floor(timeLeft/60).toString().padStart(2,'0');
      let sec = (timeLeft%60).toString().padStart(2,'0');
      document.getElementById('timer').innerText = `${min}:${sec}`;
    }

    // --- –†—ñ–≤–µ–Ω—å ---
    function setLevel(newLevel) {
      level = newLevel;
      if (level > totalLevels) {
        gameOver = true;
        clearInterval(timerId);
        draw();
        setTimeout(()=>alert('–ì—Ä—É –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: '+score), 100);
        return;
      }
      bg.src = backgrounds[level-1];
      document.getElementById('level').innerText = level;
      timeLeft = LEVEL_TIME;
      updateTimer();
      // –ó–º—ñ–Ω–∏—Ç–∏ —à–≤–∏–¥–∫—ñ—Å—Ç—å —è—Ö—Ç–∏ (–ø–ª–∞–≤–Ω–æ)
      yachtSpeed = 1.0 + (level-1)*0.7;
    }

    // --- –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –º—É—à–ª—ñ —Ç–∞ —è—Ö—Ç–∏ ---
    function randomShell() {
      return {
        x: Math.random()*(CANVAS_W-SHELL_W),
        y: Math.random()*(CANVAS_H-SHELL_H)
      }
    }
    function resetYacht() {
      yachtPos = {x: Math.random()*(CANVAS_W-90), y: Math.random()*(CANVAS_H-110)};
    }

    // --- –ì–æ–ª–æ–≤–Ω–∞ –∞–Ω—ñ–º–∞—Ü—ñ—è ---
    function draw() {
      ctx.clearRect(0,0,CANVAS_W,CANVAS_H);
      if (bg.complete) ctx.drawImage(bg, 0, 0, CANVAS_W, CANVAS_H);
      // –Ø—Ö—Ç–∞
      if (yacht.complete) ctx.drawImage(yacht, yachtPos.x, yachtPos.y, 90, 110);
      // –ú—É—à–ª—è
      if (shellAnim.show && shell.complete) {
        ctx.save();
        ctx.globalAlpha = shellAnim.fade;
        ctx.translate(shellPos.x+SHELL_W/2, shellPos.y+SHELL_H/2);
        ctx.scale(shellAnim.scale, shellAnim.scale);
        ctx.drawImage(shell, -SHELL_W/2, -SHELL_H/2, SHELL_W, SHELL_H);
        ctx.restore();
      }
      // –î—ñ–Ω–∞ (–∑–±—ñ–ª—å—à–µ–Ω–Ω—è –¥–æ 3—Ö)
      let playerScale = Math.min(1 + score * 0.01, PLAYER_MAX_SCALE);
      if (dina.complete) {
        ctx.save();
        ctx.translate(player.x + PLAYER_W/2, player.y + PLAYER_H/2);
        ctx.scale(playerScale, playerScale);
        ctx.drawImage(dina, -PLAYER_W/2, -PLAYER_H/2, PLAYER_W, PLAYER_H);
        ctx.restore();
      }
      // –ë—É–ª—å–±–∞—à–∫–∏
      bubbles.forEach(b=>{
        ctx.save();
        ctx.globalAlpha = b.alpha;
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
        ctx.fillStyle = '#b6f5ff88';
        ctx.fill();
        ctx.restore();
      });
    }

    // --- –†—É—Ö —è—Ö—Ç–∏ –¥–æ –º—É—à–ª—ñ ---
    function moveYacht() {
      let dx = shellPos.x - yachtPos.x;
      let dy = shellPos.y - yachtPos.y;
      let len = Math.sqrt(dx*dx + dy*dy);
      if (len>1) {
        yachtPos.x += dx/len * yachtSpeed;
        yachtPos.y += dy/len * yachtSpeed;
      }
    }

    // --- –ë—É–ª—å–±–∞—à–∫–∏ (–∞–Ω—ñ–º–∞—Ü—ñ—è) ---
    let bubbles = [];
    function updateBubbles() {
      // –î–æ–¥–∞—î–º–æ –Ω–æ–≤—É –±—É–ª—å–±–∞—à–∫—É –≤–∏–ø–∞–¥–∫–æ–≤–æ
      if (Math.random() < 0.04 && bubbles.length < 16) {
        bubbles.push({
          x: Math.random()*CANVAS_W,
          y: CANVAS_H + 40,
          r: 16+Math.random()*22,
          alpha: 0.18+Math.random()*0.17,
          speed: 0.6+Math.random()*1.6
        });
      }
      // –ê–Ω—ñ–º–∞—Ü—ñ—è –≤—Å—ñ—Ö –±—É–ª—å–±–∞—à–æ–∫
      for(let b of bubbles) b.y -= b.speed;
      // –í–∏–¥–∞–ª–∏—Ç–∏ —Ç—ñ, —â–æ –≤–∏–π—à–ª–∏ –∑–∞ –º–µ–∂—ñ
      bubbles = bubbles.filter(b => b.y + b.r > -20);
    }

    // --- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è ---
    function movePlayer(dx, dy) {
      let playerScale = Math.min(1 + score * 0.01, PLAYER_MAX_SCALE);
      let w = PLAYER_W*playerScale, h = PLAYER_H*playerScale;
      player.x = Math.max(0, Math.min(CANVAS_W-w, player.x+dx));
      player.y = Math.max(0, Math.min(CANVAS_H-h, player.y+dy));
      draw();
      checkCatch();
    }
    document.getElementById('btn-up').onclick = ()=>movePlayer(0, -MOVE_STEP);
    document.getElementById('btn-down').onclick = ()=>movePlayer(0, MOVE_STEP);
    document.getElementById('btn-left').onclick = ()=>movePlayer(-MOVE_STEP, 0);
    document.getElementById('btn-right').onclick = ()=>movePlayer(MOVE_STEP, 0);

    // --- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑—ñ—Ç–∫–Ω–µ–Ω—å ---
    function checkCatch() {
      let playerScale = Math.min(1 + score * 0.01, PLAYER_MAX_SCALE);
      let w = PLAYER_W*playerScale, h = PLAYER_H*playerScale;
      if (!shellAnim.show) return;
      if (player.x < shellPos.x+SHELL_W && player.x+w > shellPos.x &&
          player.y < shellPos.y+SHELL_H && player.y+h > shellPos.y) {
        score++;
        document.getElementById('score').innerText = score;
        animateShellCatch(()=>{
          shellPos = randomShell();
          shellAnim = {scale:1, fade:1, show:true};
          draw();
        });
      }
      // –Ø–∫—â–æ —è—Ö—Ç–∞ "–∑–±–∏—Ä–∞—î"
      if (yachtPos.x < shellPos.x+SHELL_W && yachtPos.x+90 > shellPos.x &&
          yachtPos.y < shellPos.y+SHELL_H && yachtPos.y+110 > shellPos.y) {
        shellAnim.show = false;
        setTimeout(()=>{
          shellPos = randomShell();
          resetYacht();
          shellAnim = {scale:1, fade:1, show:true};
          draw();
        }, 350);
      }
    }

    // --- –ê–Ω—ñ–º–∞—Ü—ñ—è –º—É—à–ª—ñ –ø—Ä–∏ –∑–±–æ—Ä—ñ ---
    function animateShellCatch(cb) {
      shellAnim.show = true;
      shellAnim.scale = 1; shellAnim.fade = 1;
      let steps = 16, frame = 0;
      function step() {
        shellAnim.scale = 1 + 0.4*Math.sin(Math.PI*frame/steps);
        shellAnim.fade = 1 - frame/steps;
        draw();
        if (++frame<=steps) requestAnimationFrame(step);
        else { shellAnim.show = false; cb(); }
      }
      step();
    }

    // --- –ö–µ—Ä—É–≤–∞–Ω–Ω—è –∫–ª–∞–≤—ñ—à–∞–º–∏ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø—É ---
    window.addEventListener('keydown', e=>{
      if (gameOver) return;
      if (['ArrowUp','w','—Ü'].includes(e.key)) movePlayer(0, -MOVE_STEP);
      if (['ArrowDown','s','—ã'].includes(e.key)) movePlayer(0, MOVE_STEP);
      if (['ArrowLeft','a','—Ñ'].includes(e.key)) movePlayer(-MOVE_STEP, 0);
      if (['ArrowRight','d','–≤'].includes(e.key)) movePlayer(MOVE_STEP, 0);
    });

    // --- –û—Å–Ω–æ–≤–Ω–∏–π —Ü–∏–∫–ª ---
    function gameLoop() {
      moveYacht();
      updateBubbles();
      draw();
      checkCatch();
      if (!gameOver) requestAnimationFrame(gameLoop);
    }

    // --- –ó–∞–ø—É—Å–∫ –≥—Ä–∏ –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ---
    let loaded = 0;
    [bg, dina, shell, yacht].forEach(img => {
      img.onload = ()=>{ loaded++; if (loaded==4) startGame(); }
    });
    bg.src = backgrounds[0];
    function startGame() {
      setLevel(1);
      draw();
      startTimer();
      gameLoop();
    }
  </script>
</body>
</html>
