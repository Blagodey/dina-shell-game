<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Діна збирає мушлі</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #101112;
      overflow: hidden;
    }
    body {
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    #game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      max-width: 430px;
      max-height: 920px;
      background: #000;
      overflow: hidden;
      border-radius: 18px;
      box-shadow: 0 0 32px #3339;
    }
    #bg-img {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 1;
    }
    #game-canvas {
      position: absolute;
      left: 0; top: 0;
      width: 100%; height: 100%;
      z-index: 2;
      pointer-events: none;
    }
    .hud-label {
      position: absolute;
      color: #d8ffd0;
      font-weight: bold;
      font-size: 2.2vh;
      text-shadow: 0 0 8px #000, 0 2px 4px #2b3a20b8;
      z-index: 3;
      user-select: none;
      font-family: 'Segoe UI', Arial, sans-serif;
      display: flex;
      align-items: center;
    }
    #level-label { left: 12px; top: 8px; }
    #score-label { right: 12px; top: 8px; }
    #timer-label { left: 12px; bottom: 105px; }
    #hourglass-img {
      width: 30px; height: 30px; margin-right: 8px;
      filter: drop-shadow(0 2px 4px #222a);
    }
    /* Контроллер */
    #controls {
      position: absolute;
      bottom: 25px;
      left: 0; right: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 10;
      pointer-events: none;
    }
    .control-row {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
      padding: 0;
    }
    .arrow-btn {
      background: #111e;
      border-radius: 50%;
      width: 70px; height: 70px;
      margin: 0 10px;
      border: 2px solid #12e3fa77;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 12px #0005;
      transition: background 0.1s;
      pointer-events: auto;
      touch-action: manipulation;
    }
    .arrow-btn:active {
      background: #34d7ff44;
    }
    .arrow-btn img {
      width: 42px;
      height: 42px;
      user-select: none;
      pointer-events: none;
    }
    /* Звук */
    #sound-toggle {
      position: absolute;
      right: 18px;
      bottom: 24px;
      z-index: 11;
      width: 56px; height: 56px;
      background: none; border: none;
      padding: 0;
      cursor: pointer;
      pointer-events: auto;
    }
    #sound-toggle img {
      width: 56px; height: 56px;
      filter: drop-shadow(0 2px 8px #222a);
    }
    @media (max-width: 500px) {
      #game-container { max-width: 100vw; max-height: 100vh; }
      .arrow-btn { width: 62px; height: 62px; }
      #sound-toggle { width: 44px; height: 44px; }
      #sound-toggle img { width: 44px; height: 44px; }
    }
  </style>
</head>
<body>
  <div id="game-container">
    <img id="bg-img" src="backgrounds/bg1.jpg" alt="bg">
    <canvas id="game-canvas" width="430" height="920"></canvas>

    <!-- HUD -->
    <div class="hud-label" id="level-label">Рівень: 1</div>
    <div class="hud-label" id="score-label">Бонуси: 0</div>
    <div class="hud-label" id="timer-label">
      <img id="hourglass-img" src="icons/hourglass.png" alt="hourglass">
      <span id="timer-text">00:00</span>
    </div>

    <!-- Контроллер -->
    <div id="controls">
      <div class="control-row">
        <button class="arrow-btn" id="btn-up"><img src="icons/up.png" alt="up"></button>
      </div>
      <div class="control-row">
        <button class="arrow-btn" id="btn-left"><img src="icons/left.png" alt="left"></button>
        <button class="arrow-btn" id="btn-down"><img src="icons/down.png" alt="down"></button>
        <button class="arrow-btn" id="btn-right"><img src="icons/right.png" alt="right"></button>
      </div>
    </div>

    <!-- Звук -->
    <button id="sound-toggle">
      <img src="icons/sound-on.png" id="sound-img" alt="sound">
    </button>

    <!-- Музика -->
    <audio id="bg-music" src="music/yachting-song.MP3" loop></audio>
  </div>
  <script>
    // --- Константи
    const CANVAS_W = 430, CANVAS_H = 920; // формат 9:16
    // --- Завантаження
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    const dinaImg = new Image();
    dinaImg.src = 'icons/dina.png';
    const shellImg = new Image();
    shellImg.src = 'icons/shell.png';
    const yachtImg = new Image();
    yachtImg.src = 'yachts/yacht.png'; // якщо є

    // --- Гра: стан
    let dina = { x: CANVAS_W/2, y: CANVAS_H/2, size: 90, maxSize: 270, scale: 1 };
    let shell = { x: 80, y: 300, size: 50, collected: false };
    let level = 1, score = 0, timer = 30, gameRunning = true;
    let moveDir = {x: 0, y: 0};
    let musicOn = true;

    // --- Фоновий звук
    const bgMusic = document.getElementById('bg-music');
    bgMusic.volume = 0.22;

    // Автоматичне відтворення на дотику (моб. браузери)
    document.body.addEventListener('touchstart', () => {
      if (musicOn) bgMusic.play();
    }, {once:true});
    document.body.addEventListener('click', () => {
      if (musicOn) bgMusic.play();
    }, {once:true});

    // --- Кнопки управління
    document.getElementById('btn-up').addEventListener('touchstart', e => {moveDir.y = -1; e.preventDefault();});
    document.getElementById('btn-up').addEventListener('touchend', e => {moveDir.y = 0; e.preventDefault();});
    document.getElementById('btn-down').addEventListener('touchstart', e => {moveDir.y = 1; e.preventDefault();});
    document.getElementById('btn-down').addEventListener('touchend', e => {moveDir.y = 0; e.preventDefault();});
    document.getElementById('btn-left').addEventListener('touchstart', e => {moveDir.x = -1; e.preventDefault();});
    document.getElementById('btn-left').addEventListener('touchend', e => {moveDir.x = 0; e.preventDefault();});
    document.getElementById('btn-right').addEventListener('touchstart', e => {moveDir.x = 1; e.preventDefault();});
    document.getElementById('btn-right').addEventListener('touchend', e => {moveDir.x = 0; e.preventDefault();});

    // Для миші та клавіатури
    document.getElementById('btn-up').addEventListener('mousedown', e => {moveDir.y = -1;});
    document.getElementById('btn-up').addEventListener('mouseup', e => {moveDir.y = 0;});
    document.getElementById('btn-down').addEventListener('mousedown', e => {moveDir.y = 1;});
    document.getElementById('btn-down').addEventListener('mouseup', e => {moveDir.y = 0;});
    document.getElementById('btn-left').addEventListener('mousedown', e => {moveDir.x = -1;});
    document.getElementById('btn-left').addEventListener('mouseup', e => {moveDir.x = 0;});
    document.getElementById('btn-right').addEventListener('mousedown', e => {moveDir.x = 1;});
    document.getElementById('btn-right').addEventListener('mouseup', e => {moveDir.x = 0;});

    // --- Звук
    const soundBtn = document.getElementById('sound-toggle');
    const soundImg = document.getElementById('sound-img');
    soundBtn.addEventListener('click', () => {
      musicOn = !musicOn;
      if (musicOn) {
        bgMusic.play();
        soundImg.src = 'icons/sound-on.png';
      } else {
        bgMusic.pause();
        soundImg.src = 'icons/sound-off.png';
      }
    });

    // --- Управління з клавіатури
    window.addEventListener('keydown', (e) => {
      switch(e.key) {
        case 'ArrowUp': moveDir.y = -1; break;
        case 'ArrowDown': moveDir.y = 1; break;
        case 'ArrowLeft': moveDir.x = -1; break;
        case 'ArrowRight': moveDir.x = 1; break;
      }
    });
    window.addEventListener('keyup', (e) => {
      if (['ArrowUp','ArrowDown'].includes(e.key)) moveDir.y = 0;
      if (['ArrowLeft','ArrowRight'].includes(e.key)) moveDir.x = 0;
    });

    // --- Ігровий цикл
    function gameLoop() {
      // Рух
      let speed = 3 + (level-1)*0.5; // на перших рівнях повільніше
      if (level < 3) speed /= 2.5;
      dina.x += moveDir.x * speed;
      dina.y += moveDir.y * speed;
      // Кордони
      dina.x = Math.max(0, Math.min(CANVAS_W-dina.size, dina.x));
      dina.y = Math.max(0, Math.min(CANVAS_H-dina.size, dina.y));

      // Збір мушлі
      let dist = Math.hypot(dina.x-shell.x, dina.y-shell.y);
      if (dist < (dina.size+shell.size)/2 && !shell.collected) {
        shell.collected = true;
        score += 10;
        // Збільшуємо Діну (макс 3x)
        if (dina.scale < 3) dina.scale += 0.1;
        dina.size = 90 * dina.scale;
        setTimeout(spawnShell, 700);
      }

      // Малювання
      ctx.clearRect(0,0,CANVAS_W,CANVAS_H);

      // Мушля
      if (!shell.collected) ctx.drawImage(shellImg, shell.x, shell.y, shell.size, shell.size);

      // Діна
      ctx.drawImage(dinaImg, dina.x, dina.y, dina.size, dina.size);

      // (Якщо потрібно — яхта)
      // ctx.drawImage(yachtImg, ...)

      // Оновлення HUD
      document.getElementById('level-label').innerText = 'Рівень: ' + level;
      document.getElementById('score-label').innerText = 'Бонуси: ' + score;
      document.getElementById('timer-text').innerText = ("00:" + timer.toString().padStart(2,'0'));

      if (gameRunning) requestAnimationFrame(gameLoop);
    }

    function spawnShell() {
      shell.x = Math.random() * (CANVAS_W-60) + 30;
      shell.y = Math.random() * (CANVAS_H-200) + 60;
      shell.collected = false;
    }

    // --- Таймер
    setInterval(() => {
      if (!gameRunning) return;
      timer--;
      if (timer<=0) {
        // Кінець рівня
        level++; timer = 30;
        dina.scale = 1; dina.size = 90; // reset
      }
    }, 1000);

    // --- Старт
    dinaImg.onload = shellImg.onload = () => { gameLoop(); }

  </script>
</body>
</html>
