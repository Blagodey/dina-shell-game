<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Діна збирає мушлі — рівні</title>
  <style>
    body {
      background: #18191a;
      color: #b0ffb7;
      font-family: 'Segoe UI', Arial, sans-serif;
      text-align: center;
      margin: 0;
    }
    h1 { margin-top: 24px; margin-bottom: 6px; font-size: 2.2em; color: #95fa92;}
    .game-container {
      margin: 0 auto;
      border: 2px solid #62d362;
      border-radius: 18px;
      width: 960px;
      height: 540px;
      position: relative;
      background: #111;
      overflow: hidden;
      box-shadow: 0 0 40px #1a3b26cc;
    }
    #game-canvas {
      display: block;
      margin: 0 auto;
      background: #000;
      border-radius: 14px;
      box-shadow: 0 0 16px #222b;
      touch-action: none;
    }
    .score, .level, .timer {
      color: #b0ffb7;
      font-size: 1.15em;
      margin: 6px 0 2px 0;
      letter-spacing: 2px;
    }
    .level { color: #97e8fd;}
    .timer { color: #ffeda0;}
    @media (max-width:1000px) {
      .game-container, #game-canvas { width: 98vw !important; height: 56vw !important; max-width: 100vw;}
    }
  </style>
</head>
<body>
  <h1>Діна збирає мушлі</h1>
  <div class="level">Рівень: <span id="level">1</span></div>
  <div class="score">Бонуси: <span id="score">0</span></div>
  <div class="timer">Залишилось часу: <span id="timer">01:00</span></div>
  <div class="game-container">
    <canvas id="game-canvas" width="960" height="540"></canvas>
  </div>
  <audio id="bg-music" src="music/yachting-song.WAV" loop></audio>
  <script>
    // --- Налаштування та ресурси ---
    const CANVAS_W = 960, CANVAS_H = 540;
    const BASE_W = 120, BASE_H = 60;
    const SHELL_W = 48, SHELL_H = 48;
    const YACHT_W = 90, YACHT_H = 110;
    const MOVE_STEP = 18;
    const LEVEL_TIME = 60;
    const MAX_SCALE = 1.5;
    let dinaScale = 1;

    const backgrounds = [
      'backgrounds/bg1.jpg',
      'backgrounds/bg2.jpg',
      'backgrounds/bg3.jpg',
      'backgrounds/bg4.jpg',
      'backgrounds/bg5.jpg',
      'backgrounds/bg6.jpg'
    ];
    let level = 0, totalLevels = backgrounds.length;

    const bg = new Image();
    const dina = new Image();
    dina.src = 'icons/dina.png';
    const shell = new Image();
    shell.src = 'icons/shell.png';
    const yacht = new Image();
    yacht.src = 'yachts/yacht1.png';

    // --- Гра ---
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    let player = {x: CANVAS_W/2-BASE_W/2, y: CANVAS_H/2-BASE_H/2};
    let shellPos = randomShell();
    let shellAnim = {scale: 1, fade: 1, show: true};
    let score = 0;
    let timeLeft = LEVEL_TIME;
    let timerId = null;
    let gameOver = false;
    // Яхта-конкурент:
    let yachtPos = {x: 0, y: 0};
    let yachtSpeed = 2.0;

    // --- Бульбашки ---
    let bubbles = [];
    function spawnBubble() {
      let x = Math.random()*CANVAS_W, r = 10+Math.random()*18;
      bubbles.push({
        x, y: CANVAS_H+20, r, speed: 0.9+Math.random()*1.3, alpha: 0.25+Math.random()*0.45
      });
    }

    // --- Музика ---
    const music = document.getElementById('bg-music');
    window.addEventListener('keydown', () => {
      if (music.paused) music.play();
    }, {once:true});

    // --- Функція зміни рівня ---
    function setLevel(newLevel) {
      level = newLevel;
      if (level > totalLevels) {
        gameOver = true;
        clearInterval(timerId);
        draw();
        setTimeout(()=>alert('Вітаємо! Гру завершено. Ваш результат: '+score), 100);
        return;
      }
      bg.src = backgrounds[level-1];
      document.getElementById('level').innerText = level;
      timeLeft = LEVEL_TIME;
      updateTimer();
      dinaScale = 1;
      yachtSpeed = 2.0 + 0.2*level;
      resetYacht();
    }

    // --- Малювання гри з анімацією ---
    function draw() {
      ctx.clearRect(0,0, CANVAS_W, CANVAS_H);
      if (bg.complete) ctx.drawImage(bg, 0,0, CANVAS_W, CANVAS_H);

      // Бульбашки
      bubbles.forEach(b=>{
        ctx.save();
        ctx.globalAlpha = b.alpha;
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.r, 0, 2*Math.PI);
        ctx.fillStyle = "#AEEEF8";
        ctx.fill();
        ctx.restore();
      });

      // Мушля
      if (shellAnim.show && shell.complete) {
        ctx.save();
        ctx.globalAlpha = shellAnim.fade;
        ctx.translate(shellPos.x+SHELL_W/2, shellPos.y+SHELL_H/2);
        ctx.scale(shellAnim.scale, shellAnim.scale);
        ctx.drawImage(shell, -SHELL_W/2, -SHELL_H/2, SHELL_W, SHELL_H);
        ctx.restore();
      }
      // Яхта-конкурент
      if (yacht.complete) {
        ctx.drawImage(yacht, yachtPos.x, yachtPos.y, YACHT_W, YACHT_H);
      }
      // Діна
      if (dina.complete) {
        let w = BASE_W*dinaScale, h = BASE_H*dinaScale;
        ctx.drawImage(dina, player.x, player.y, w, h);
      }
    }

    // --- Рух гравця ---
    window.addEventListener('keydown', (e) => {
      if (gameOver) return;
      let w = BASE_W*dinaScale, h = BASE_H*dinaScale;
      switch(e.key) {
        case 'ArrowLeft': case 'a': player.x = Math.max(0, player.x-MOVE_STEP); break;
        case 'ArrowRight': case 'd': player.x = Math.min(CANVAS_W-w, player.x+MOVE_STEP); break;
        case 'ArrowUp': case 'w': player.y = Math.max(0, player.y-MOVE_STEP); break;
        case 'ArrowDown': case 's': player.y = Math.min(CANVAS_H-h, player.y+MOVE_STEP); break;
      }
      draw();
      checkCatch();
    });

    // --- Свайпи для мобільних ---
    let touchStart = null;
    canvas.addEventListener('touchstart', e=>{
      if (gameOver) return;
      let t = e.touches[0];
      touchStart = {x:t.clientX, y:t.clientY};
    });
    canvas.addEventListener('touchend', e=>{
      if (!touchStart || gameOver) return;
      let t = e.changedTouches[0];
      let dx = t.clientX - touchStart.x, dy = t.clientY - touchStart.y;
      let adx = Math.abs(dx), ady = Math.abs(dy);
      let w = BASE_W*dinaScale, h = BASE_H*dinaScale;
      if (adx > ady) {
        if (dx>25) player.x = Math.min(CANVAS_W-w, player.x+MOVE_STEP);
        else if (dx<-25) player.x = Math.max(0, player.x-MOVE_STEP);
      } else {
        if (dy>25) player.y = Math.min(CANVAS_H-h, player.y+MOVE_STEP);
        else if (dy<-25) player.y = Math.max(0, player.y-MOVE_STEP);
      }
      draw(); checkCatch();
      touchStart = null;
    });

    // --- Генерація позиції бонусу ---
    function randomShell() {
      return {
        x: Math.random()*(CANVAS_W-SHELL_W-30)+15,
        y: Math.random()*(CANVAS_H-SHELL_H-30)+15
      }
    }

    // --- Анімація при зборі мушлі ---
    function animateShellCatch(cb) {
      shellAnim.show = true;
      shellAnim.scale = 1;
      shellAnim.fade = 1;
      let steps = 16;
      let frame = 0;
      function step() {
        shellAnim.scale = 1 + 0.4*Math.sin(Math.PI*frame/steps);
        shellAnim.fade = 1 - frame/steps;
        draw();
        if (++frame<=steps) requestAnimationFrame(step);
        else {
          shellAnim.show = false;
          cb();
        }
      }
      step();
    }

    // --- Перевірка на зіткнення ---
    function checkCatch() {
      let w = BASE_W*dinaScale, h = BASE_H*dinaScale;
      if (!shellAnim.show) return;
      // Діна ловить мушлю
      if (player.x < shellPos.x+SHELL_W && player.x+w > shellPos.x &&
          player.y < shellPos.y+SHELL_H && player.y+h > shellPos.y) {
        score++;
        document.getElementById('score').innerText = score;
        dinaScale = Math.min(dinaScale * 1.01, MAX_SCALE); // +1% до максимуму
        animateShellCatch(()=>{
          shellPos = randomShell();
          shellAnim = {scale:1, fade:1, show:true};
          draw();
        });
      }
      // Яхта ловить мушлю
      else if (yachtPos.x < shellPos.x+SHELL_W && yachtPos.x+YACHT_W > shellPos.x &&
          yachtPos.y < shellPos.y+SHELL_H && yachtPos.y+YACHT_H > shellPos.y) {
        // Ефект shake:
        shakeScreen();
        shellAnim.show = false;
        setTimeout(()=>{
          shellPos = randomShell();
          shellAnim = {scale:1, fade:1, show:true};
          draw();
        }, 400);
      }
    }

    // --- Яхта рух ---
    function resetYacht() {
      // Яхта стартує зліва або згори
      if (Math.random()<0.5)
        yachtPos = {x: Math.random()*(CANVAS_W-YACHT_W), y: 0};
      else
        yachtPos = {x: 0, y: Math.random()*(CANVAS_H-YACHT_H)};
    }
    function moveYacht() {
      // Йде до мушлі
      let dx = shellPos.x - yachtPos.x, dy = shellPos.y - yachtPos.y;
      let len = Math.sqrt(dx*dx+dy*dy);
      if (len>1) {
        yachtPos.x += dx/len * yachtSpeed;
        yachtPos.y += dy/len * yachtSpeed;
      }
    }

    // --- Бульбашки ---
    function moveBubbles() {
      // Нові з ймовірністю 0.02 на кадр (3–6)
      if (Math.random()<0.02 && bubbles.length<18) spawnBubble();
      bubbles.forEach(b=>b.y -= b.speed);
      bubbles = bubbles.filter(b=>b.y > -40);
    }

    // --- Ефект shake ---
    function shakeScreen() {
      let el = document.querySelector('.game-container');
      el.style.transition = '0s';
      el.style.transform = 'translateX(-10px)';
      setTimeout(()=>el.style.transform='translateX(10px)', 80);
      setTimeout(()=>el.style.transform='translateX(-6px)', 160);
      setTimeout(()=>el.style.transform='translateX(0)', 260);
    }

    // --- Таймер ---
    function startTimer() {
      timerId = setInterval(()=>{
        if (--timeLeft<=0) {
          timeLeft = 0;
          level++;
          if (level <= totalLevels) {
            setLevel(level);
            shellPos = randomShell();
            player = {x: CANVAS_W/2-BASE_W/2, y: CANVAS_H/2-BASE_H/2};
            shellAnim = {scale:1, fade:1, show:true};
            draw();
          } else {
            gameOver = true;
            clearInterval(timerId);
          }
        }
        updateTimer();
      }, 1000);
    }
    function updateTimer() {
      let min = Math.floor(timeLeft/60).toString().padStart(2,'0');
      let sec = (timeLeft%60).toString().padStart(2,'0');
      document.getElementById('timer').innerText = `${min}:${sec}`;
    }

    // --- Ігровий цикл ---
    function gameLoop() {
      if (!gameOver) {
        moveBubbles();
        moveYacht();
        draw();
        checkCatch();
        requestAnimationFrame(gameLoop);
      }
    }

    // --- Старт гри ---
    function startGame() {
      setLevel(1);
      draw();
      startTimer();
      requestAnimationFrame(gameLoop);
    }
    // Дочекайся завантаження всіх ресурсів
    let loaded = 0;
    [bg, dina, shell, yacht].forEach(img => {
      img.onload = ()=>{
        loaded++;
        if (loaded==4) startGame();
      }
    });
    bg.src = backgrounds[0];
  </script>
</body>
</html>
