<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Діна збирає мушлі</title>
  <style>
    /* Скидання стилів та встановлення висоти на 100% для html та body */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: #000;
    }
    /* Контейнер гри центрується горизонтально */
    #gameContainer {
      position: relative;
      margin: 0 auto;
      /* Ширина та висота будуть встановлені скриптом відповідно до canvas */
    }
    canvas {
      display: block;
      background: #000; /* запасний колір фону */
    }
    /* Панель інтерфейсу (HUD) зверху */
    #hud {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      color: #fff;
      font-family: Arial, sans-serif;
      font-size: 18px;
      text-shadow: 1px 1px 2px #000;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 10px;
      box-sizing: border-box;
      z-index: 2;
    }
    #hud span {
      display: inline-flex;
      align-items: center;
      margin: 0 5px;
    }
    #hud img.icon-small {
      width: 24px;
      height: 24px;
      margin-right: 5px;
    }
    #soundToggle {
      width: 24px;
      height: 24px;
      cursor: pointer;
    }
    /* Блок з кнопками керування (тільки для мобільних пристроїв) */
    #controls {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 150px;
      height: 150px;
      z-index: 2;
      /* Спочатку видно, але JS може приховати на ПК */
    }
    #controls img {
      position: absolute;
      width: 48px;
      height: 48px;
      opacity: 0.8; /* трохи прозорі для кращого огляду фону */
      /* Заборона виділення та перетягування зображень */
      user-select: none;
      -webkit-user-drag: none;
      -webkit-touch-callout: none;
    }
    #btnUp    { top: 0; left: 50%; transform: translateX(-50%); }
    #btnDown  { bottom: 0; left: 50%; transform: translateX(-50%); }
    #btnLeft  { left: 0; top: 50%; transform: translateY(-50%); }
    #btnRight { right: 0; top: 50%; transform: translateY(-50%); }
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="gameCanvas"></canvas>
    <!-- Панель інтерфейсу: рахунок, таймер, рівень, кнопка звуку -->
    <div id="hud">
      <span id="scoreDisplay">
        <img src="icons/shell.png" class="icon-small" alt="Мушля">
        <span id="scoreText">0</span>
      </span>
      <span id="timeDisplay">
        <img src="icons/hourglass.png" class="icon-small" alt="Час">
        <span id="timeText">60</span>
      </span>
      <span id="levelDisplay">Рівень: <span id="levelText">1</span></span>
      <img id="soundToggle" src="icons/sound-on.png" alt="Звук">
    </div>
    <!-- Кнопки керування (відображаються тільки на мобільних пристроях) -->
    <div id="controls">
      <img id="btnUp" src="icons/up.png" alt="Вгору">
      <img id="btnDown" src="icons/down.png" alt="Вниз">
      <img id="btnLeft" src="icons/left.png" alt="Вліво">
      <img id="btnRight" src="icons/right.png" alt="Вправо">
    </div>
  </div>
  <script>
    // Налаштування canvas відповідно до розміру вікна (збереження пропорції 9:16)
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    function resizeCanvas() {
      const winH = window.innerHeight;
      const winW = window.innerWidth;
      // Робимо висоту canvas рівною висоті вікна, ширину - пропорційно 9:16
      canvas.height = winH;
      canvas.width = Math.floor(winH * 9 / 16);
      // Якщо отримана ширина більша за ширину вікна, коригуємо по ширині (і відповідно висоту)
      if (canvas.width > winW) {
        canvas.width = winW;
        canvas.height = Math.floor(canvas.width * 16 / 9);
      }
      // Оновити розміри контейнера для правильного центрування
      const container = document.getElementById('gameContainer');
      container.style.width = canvas.width + 'px';
      container.style.height = canvas.height + 'px';
    }
    resizeCanvas();
    // Повторно змінюємо розмір canvas при зміні розміру вікна
    window.addEventListener('resize', resizeCanvas);
    // Змінні стану гри
    let score = 0;
    let level = 1;
    let gameOver = false;
    let timeLeft = 60; // секунд залишилось
    // Швидкості руху персонажів (пікселів за секунду)
    const DINA_SPEED = 300;
    const YACHT_SPEED = 240;
    // Об'єкти гри та їх властивості
    const dina = { x: 0, y: 0, width: 0, height: 0 };
    const yacht = { x: 0, y: 0, width: 0, height: 0 };
    const shell = { x: 0, y: 0, width: 0, height: 0 };
    // Завантаження зображень
    const images = {};
    const imageNames = ['dina', 'shell', 'yacht1', 'bg1', 'bg2', 'bg3', 'bg4', 'bg5', 'bg6'];
    let imagesLoaded = 0;
    const totalImages = imageNames.length;
    for (let name of imageNames) {
      images[name] = new Image();
      if (name.startsWith('bg')) {
        images[name].src = 'backgrounds/' + name + '.jpg';
      } else if (name === 'yacht1') {
        images[name].src = 'yachts/' + name + '.png';
      } else {
        images[name].src = 'icons/' + name + '.png';
      }
      images[name].onload = function() {
        imagesLoaded++;
        if (imagesLoaded === totalImages) {
          startGame();
        }
      };
    }
    // Аудіо: фонова музика
    const bgMusic = new Audio('music/yachting-song.MP3');
    bgMusic.loop = true;
    let soundEnabled = true;
    let musicStarted = false;
    // Функція старту гри після завантаження ресурсів
    function startGame() {
      // Встановлюємо початкові розміри персонажів на основі розміру canvas
      // Діна ~10% висоти
      dina.height = canvas.height * 0.1;
      dina.width = dina.height * (images['dina'].width / images['dina'].height || 1);
      // Яхта ~15% висоти
      yacht.height = canvas.height * 0.15;
      yacht.width = yacht.height * (images['yacht1'].width / images['yacht1'].height || 1);
      // Мушля ~5% висоти
      shell.height = canvas.height * 0.05;
      shell.width = shell.height * (images['shell'].width / images['shell'].height || 1);
      // Початкові позиції об'єктів
      dina.x = (canvas.width - dina.width) / 2;
      dina.y = canvas.height - dina.height; // Діна внизу по центру
      yacht.x = (canvas.width - yacht.width) / 2;
      yacht.y = 0; // Яхта зверху по центру
      // Створити першу мушлю у випадковій позиції
      spawnShell();
      // Автоматично запускати музику, якщо звук увімкнено (може бути заблоковано політикою браузера)
      if (soundEnabled) {
        bgMusic.play().then(function() { musicStarted = true; }).catch(function() { /* Автозапуск звуку заблоковано */ });
      }
      // Запустити таймер відліку часу
      setInterval(function() {
        if (gameOver) return;
        timeLeft--;
        if (timeLeft < 0) timeLeft = 0;
        document.getElementById('timeText').innerText = timeLeft;
        if (timeLeft === 0) {
          // Кінець гри
          gameOver = true;
          alert('Час вийшов! Ваш рахунок: ' + score);
        }
      }, 1000);
      // Запустити основний цикл гри
      requestAnimationFrame(gameLoop);
    }
    // Функція для появи нової мушлі у випадковій позиції
    function spawnShell() {
      shell.x = Math.random() * (canvas.width - shell.width);
      shell.y = Math.random() * (canvas.height - shell.height);
    }
    // Стани натиснутих кнопок керування
    let upPressed = false, downPressed = false, leftPressed = false, rightPressed = false;
    // Обробники подій клавіатури для керування Діною
    document.addEventListener('keydown', function(e) {
      if (e.key === 'ArrowUp')    { upPressed = true; e.preventDefault(); }
      if (e.key === 'ArrowDown')  { downPressed = true; e.preventDefault(); }
      if (e.key === 'ArrowLeft')  { leftPressed = true; e.preventDefault(); }
      if (e.key === 'ArrowRight') { rightPressed = true; e.preventDefault(); }
      // На перше натискання клавіші запускаємо музику, якщо звук увімкнено
      if (!musicStarted && soundEnabled) {
        bgMusic.play();
        musicStarted = true;
      }
    });
    document.addEventListener('keyup', function(e) {
      if (e.key === 'ArrowUp')    upPressed = false;
      if (e.key === 'ArrowDown')  downPressed = false;
      if (e.key === 'ArrowLeft')  leftPressed = false;
      if (e.key === 'ArrowRight') rightPressed = false;
    });
    // Обробники подій для кнопок керування (сенсорні екрани)
    const btnUp    = document.getElementById('btnUp');
    const btnDown  = document.getElementById('btnDown');
    const btnLeft  = document.getElementById('btnLeft');
    const btnRight = document.getElementById('btnRight');
    // Функція прив'язки подій до кнопки напрямку
    function setupButton(btn, direction) {
      btn.addEventListener('touchstart', function(e) {
        e.preventDefault();
        if (direction === 'up')    upPressed = true;
        if (direction === 'down')  downPressed = true;
        if (direction === 'left')  leftPressed = true;
        if (direction === 'right') rightPressed = true;
        // На перший дотик запускаємо музику, якщо звук увімкнено
        if (!musicStarted && soundEnabled) {
          bgMusic.play();
          musicStarted = true;
        }
      });
      btn.addEventListener('touchend', function(e) {
        e.preventDefault();
        if (direction === 'up')    upPressed = false;
        if (direction === 'down')  downPressed = false;
        if (direction === 'left')  leftPressed = false;
        if (direction === 'right') rightPressed = false;
      });
      btn.addEventListener('touchcancel', function() {
        // Якщо дотик перервано, припиняємо рух
        if (direction === 'up')    upPressed = false;
        if (direction === 'down')  downPressed = false;
        if (direction === 'left')  leftPressed = false;
        if (direction === 'right') rightPressed = false;
      });
      // Додаємо також події миші (для тестування на ПК)
      btn.addEventListener('mousedown', function(e) {
        e.preventDefault();
        if (direction === 'up')    upPressed = true;
        if (direction === 'down')  downPressed = true;
        if (direction === 'left')  leftPressed = true;
        if (direction === 'right') rightPressed = true;
      });
      btn.addEventListener('mouseup', function() {
        if (direction === 'up')    upPressed = false;
        if (direction === 'down')  downPressed = false;
        if (direction === 'left')  leftPressed = false;
        if (direction === 'right') rightPressed = false;
      });
    }
    setupButton(btnUp, 'up');
    setupButton(btnDown, 'down');
    setupButton(btnLeft, 'left');
    setupButton(btnRight, 'right');
    // Приховати кнопки керування на пристроях без сенсорного екрану (ПК)
    if (!('ontouchstart' in window)) {
      document.getElementById('controls').style.display = 'none';
    }
    // Перемикання звуку (іконка "звук")
    const soundToggle = document.getElementById('soundToggle');
    soundToggle.addEventListener('click', function() {
      if (soundEnabled) {
        // Вимкнути звук
        soundEnabled = false;
        soundToggle.src = 'icons/sound-off.png';
        bgMusic.pause();
      } else {
        // Увімкнути звук
        soundEnabled = true;
        soundToggle.src = 'icons/sound-on.png';
        // Запустити музику, якщо гра вже йде
        if (!musicStarted) {
          bgMusic.play();
          musicStarted = true;
        } else {
          // Якщо музика була на паузі, продовжити
          bgMusic.play();
        }
      }
    });
    // Основний ігровий цикл
    let lastTime = performance.now();
    function gameLoop(timestamp) {
      if (gameOver) {
        // Зупинити оновлення, гра завершена
        return;
      }
      // Розрахунок дельти часу (у секундах)
      let delta = (timestamp - lastTime) / 1000;
      if (delta > 0.05) delta = 0.05; // обмежуємо крок, щоб уникнути різких стрибків
      lastTime = timestamp;
      // Рух Діни на основі натиснутих клавіш
      let dx = 0;
      let dy = 0;
      if (upPressed)    dy -= DINA_SPEED * delta;
      if (downPressed)  dy += DINA_SPEED * delta;
      if (leftPressed)  dx -= DINA_SPEED * delta;
      if (rightPressed) dx += DINA_SPEED * delta;
      // Якщо рух по двох осях, нормалізуємо швидкість (діагональний рух)
      if (dx !== 0 && dy !== 0) {
        dx *= Math.SQRT1_2;
        dy *= Math.SQRT1_2;
      }
      // Оновлення позиції Діни
      dina.x += dx;
      dina.y += dy;
      // Обмежуємо вихід Діни за межі екрану
      if (dina.x < 0) dina.x = 0;
      if (dina.y < 0) dina.y = 0;
      if (dina.x + dina.width > canvas.width)   dina.x = canvas.width - dina.width;
      if (dina.y + dina.height > canvas.height) dina.y = canvas.height - dina.height;
      // Рух яхти автоматично до поточної мушлі
      if (shell) {
        const vx = (shell.x + shell.width/2) - (yacht.x + yacht.width/2);
        const vy = (shell.y + shell.height/2) - (yacht.y + yacht.height/2);
        const dist = Math.sqrt(vx*vx + vy*vy);
        if (dist > 0) {
          let move = YACHT_SPEED * delta;
          if (move > dist) move = dist;
          const nx = vx / dist;
          const ny = vy / dist;
          yacht.x += nx * move;
          yacht.y += ny * move;
        }
      }
      // Перевірка зіткнення Діни з мушлею
      let shellCollected = false;
      if (shell) {
        const dxCenter = (dina.x + dina.width/2) - (shell.x + shell.width/2);
        const dyCenter = (dina.y + dina.height/2) - (shell.y + shell.height/2);
        const distDS = Math.sqrt(dxCenter*dxCenter + dyCenter*dyCenter);
        if (distDS < Math.max(dina.width, dina.height) * 0.5) {
          // Діна зібрала мушлю
          score++;
          document.getElementById('scoreText').innerText = score;
          shellCollected = true;
        }
      }
      // Перевірка зіткнення яхти з мушлею (якщо Діна не зібрала)
      if (shell && !shellCollected) {
        const dxCenterY = (yacht.x + yacht.width/2) - (shell.x + shell.width/2);
        const dyCenterY = (yacht.y + yacht.height/2) - (shell.y + shell.height/2);
        const distYS = Math.sqrt(dxCenterY*dxCenterY + dyCenterY*dyCenterY);
        if (distYS < Math.max(yacht.width, yacht.height) * 0.5) {
          // Яхта дісталася мушлі першою — мушля зникає без отримання балів
          shellCollected = true;
        }
      }
      // Якщо мушлю зібрано (Діною або яхтою)
      if (shellCollected) {
        // Збільшуємо рівень, якщо досягнуто чергових 5 балів
        const newLevel = Math.floor(score / 5) + 1;
        if (newLevel > level && newLevel <= 6) {
          level = newLevel;
          document.getElementById('levelText').innerText = level;
        }
        // Створюємо нову мушлю
        spawnShell();
      }
      // Промальовка фону поточного рівня
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      let currentBgImage = images['bg' + level];
      if (!currentBgImage) currentBgImage = images['bg6'];
      ctx.drawImage(currentBgImage, 0, 0, canvas.width, canvas.height);
      // Промальовка мушлі
      if (shell) {
        ctx.drawImage(images['shell'], shell.x, shell.y, shell.width, shell.height);
      }
      // Промальовка яхти
      ctx.drawImage(images['yacht1'], yacht.x, yacht.y, yacht.width, yacht.height);
      // Промальовка Діни
      ctx.drawImage(images['dina'], dina.x, dina.y, dina.width, dina.height);
      // Запит наступного кадру анімації
      requestAnimationFrame(gameLoop);
    }
  </script>
</body>
</html>
