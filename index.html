<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Діна збирає мушлі</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <style>
    body {
      margin: 0;
      background: #111;
      overflow: hidden;
      touch-action: manipulation;
      font-family: 'Segoe UI', Verdana, Arial, sans-serif;
    }
    .game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    #gameCanvas {
      width: 100vw;
      height: 100vh;
      max-width: 100vw;
      max-height: 100vh;
      display: block;
      background: #222;
      border-radius: 0;
      box-shadow: none;
    }
    /* Кнопки стрілок */
    .arrows {
      position: absolute;
      bottom: 32px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 32px;
      z-index: 10;
    }
    .arrow-btn {
      width: 60px;
      height: 60px;
      background: none;
      border: none;
      outline: none;
      padding: 0;
      opacity: 0.95;
      transition: opacity 0.15s;
    }
    .arrow-btn:active {
      opacity: 0.6;
    }
    .arrow-img {
      width: 100%;
      height: 100%;
      pointer-events: none;
      user-select: none;
      touch-action: none;
    }
    /* Кнопка звуку */
    .sound-btn {
      position: absolute;
      top: 20px;
      right: 18px;
      width: 44px;
      height: 44px;
      background: none;
      border: none;
      z-index: 12;
      opacity: 0.92;
    }
    .sound-btn img {
      width: 100%;
      height: 100%;
      pointer-events: none;
      user-select: none;
    }
    /* Результати */
    .hud {
      position: absolute;
      width: 100vw;
      pointer-events: none;
      font-weight: 600;
      color: #e0ffe0;
      text-shadow: 1px 2px 8px #000, 0 0 1px #222;
      font-size: 1.3em;
      z-index: 11;
    }
    .hud .level {
      position: absolute;
      left: 18px;
      top: 20px;
      font-size: 1.2em;
      letter-spacing: 0.5px;
    }
    .hud .score {
      position: absolute;
      left: 18px;
      bottom: 30px;
      font-size: 1.2em;
    }
    .hud .timer {
      position: absolute;
      right: 20px;
      bottom: 30px;
      display: flex;
      align-items: center;
      font-size: 1.2em;
    }
    .hud .timer img {
      width: 24px;
      height: 24px;
      margin-right: 7px;
      vertical-align: middle;
    }
    /* Адаптація під портрет */
    @media (orientation: portrait) {
      #gameCanvas {
        width: 100vw;
        height: 100vh;
      }
      .arrows {
        bottom: 20px;
        gap: 24px;
      }
      .sound-btn {
        top: 16px;
        right: 12px;
      }
      .hud .level { top: 14px; left: 14px; }
      .hud .score { bottom: 20px; left: 14px; }
      .hud .timer { bottom: 20px; right: 14px; }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <canvas id="gameCanvas" width="540" height="960"></canvas>
    <!-- Кнопки -->
    <div class="arrows">
      <button class="arrow-btn" id="arrowLeft"><img src="icons/left.png" alt="Вліво" class="arrow-img"></button>
      <button class="arrow-btn" id="arrowUp"><img src="icons/up.png" alt="Вгору" class="arrow-img"></button>
      <button class="arrow-btn" id="arrowDown"><img src="icons/down.png" alt="Вниз" class="arrow-img"></button>
      <button class="arrow-btn" id="arrowRight"><img src="icons/right.png" alt="Вправо" class="arrow-img"></button>
    </div>
    <button class="sound-btn" id="soundBtn"><img src="icons/sound-on.png" alt="Звук" id="soundIcon"></button>
    <!-- HUD -->
    <div class="hud">
      <span class="level" id="hudLevel"></span>
      <span class="score" id="hudScore"></span>
      <span class="timer" id="hudTimer"><img src="icons/hourglass.png" alt=""> <span id="timerValue"></span></span>
    </div>
    <audio id="bgMusic" src="music/yachting-song.MP3" loop></audio>
  </div>
  <script>
    // --- Налаштування ---
    const W = 540; // канвас під 9:16 (540x960 для зручності)
    const H = 960;

    // Графіка
    const bgImg = new Image();
    bgImg.src = 'backgrounds/bg4.jpg';

    const dinaImg = new Image();
    dinaImg.src = 'icons/dina.png';

    const shellImg = new Image();
    shellImg.src = 'icons/shell.png';

    const yachtImg = new Image();
    yachtImg.src = 'yachts/yacht1.png';

    // Іконки звуку
    const soundOnImg = 'icons/sound-on.png';
    const soundOffImg = 'icons/sound-off.png';

    // --- Гра ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // Масштабування під розмір екрана
    function resizeGame() {
      let ww = window.innerWidth, wh = window.innerHeight;
      let scale = Math.min(ww/W, wh/H);
      canvas.style.width = (W*scale) + 'px';
      canvas.style.height = (H*scale) + 'px';
    }
    window.addEventListener('resize', resizeGame);
    resizeGame();

    // Стани гри
    let level = 1;
    let score = 0;
    let timeLeft = 40;
    let dina = { x: W/2-50, y: H/2+150, w: 110, h: 60, speed: 3, dx:0, dy:0, scale: 1 };
    let shells = [];
    let yacht = { x: W/2-90, y: 160, w: 95, h: 95, visible: true };

    let musicOn = true;
    const bgMusic = document.getElementById('bgMusic');
    bgMusic.volume = 0.5;

    // Ініціалізація
    function startGame() {
      level = 1;
      score = 0;
      timeLeft = 40;
      dina = { x: W/2-50, y: H/2+150, w: 110, h: 60, speed: 3, dx:0, dy:0, scale: 1 };
      yacht = { x: W/2-90, y: 160, w: 95, h: 95, visible: true };
      spawnShells();
      renderHUD();
      if (musicOn) tryPlayMusic();
      loop();
    }
    function spawnShells() {
      shells = [];
      for (let i = 0; i < 4+level; ++i) {
        let sx, sy, ok;
        do {
          sx = 50 + Math.random()*(W-100);
          sy = 320 + Math.random()*(H-400);
          ok = true;
          // не на Діні і не на яхті
          if (Math.abs(sx-dina.x)<100 && Math.abs(sy-dina.y)<70) ok=false;
          if (Math.abs(sx-yacht.x)<80 && Math.abs(sy-yacht.y)<80) ok=false;
          for (let sh of shells)
            if (Math.abs(sx-sh.x)<60 && Math.abs(sy-sh.y)<60) ok=false;
        } while (!ok);
        shells.push({ x: sx, y: sy, w: 38, h: 38, taken: false });
      }
    }

    // --- Управління ---
    function setDinaMove(dx,dy) {
      dina.dx = dx;
      dina.dy = dy;
    }
    function stopDinaMove() {
      dina.dx = 0;
      dina.dy = 0;
    }
    // Кнопки
    document.getElementById('arrowLeft').ontouchstart = () => setDinaMove(-1,0);
    document.getElementById('arrowLeft').onmousedown = () => setDinaMove(-1,0);
    document.getElementById('arrowLeft').ontouchend = document.getElementById('arrowLeft').onmouseup = stopDinaMove;
    document.getElementById('arrowRight').ontouchstart = () => setDinaMove(1,0);
    document.getElementById('arrowRight').onmousedown = () => setDinaMove(1,0);
    document.getElementById('arrowRight').ontouchend = document.getElementById('arrowRight').onmouseup = stopDinaMove;
    document.getElementById('arrowUp').ontouchstart = () => setDinaMove(0,-1);
    document.getElementById('arrowUp').onmousedown = () => setDinaMove(0,-1);
    document.getElementById('arrowUp').ontouchend = document.getElementById('arrowUp').onmouseup = stopDinaMove;
    document.getElementById('arrowDown').ontouchstart = () => setDinaMove(0,1);
    document.getElementById('arrowDown').onmousedown = () => setDinaMove(0,1);
    document.getElementById('arrowDown').ontouchend = document.getElementById('arrowDown').onmouseup = stopDinaMove;

    // Клавіатура
    document.addEventListener('keydown', e=>{
      if (e.repeat) return;
      if (e.key==='ArrowLeft') setDinaMove(-1,0);
      if (e.key==='ArrowRight') setDinaMove(1,0);
      if (e.key==='ArrowUp') setDinaMove(0,-1);
      if (e.key==='ArrowDown') setDinaMove(0,1);
    });
    document.addEventListener('keyup', e=>{
      if (['ArrowLeft','ArrowRight','ArrowUp','ArrowDown'].includes(e.key))
        stopDinaMove();
    });

    // --- Геймплей ---
    let timerInt = null, animFrame = null;
    function loop() {
      drawGame();
      animFrame = requestAnimationFrame(loop);
    }
    function drawGame() {
      // фон
      ctx.clearRect(0,0,W,H);
      ctx.drawImage(bgImg, 0, 0, W, H);
      // яхта
      if (yacht.visible) ctx.drawImage(yachtImg, yacht.x, yacht.y, yacht.w, yacht.h);
      // мушлі
      for (let sh of shells)
        if (!sh.taken)
          ctx.drawImage(shellImg, sh.x, sh.y, sh.w, sh.h);
      // Діна
      let dw = dina.w*dina.scale, dh = dina.h*dina.scale;
      ctx.drawImage(dinaImg, dina.x, dina.y, dw, dh);
    }
    // HUD
    function renderHUD() {
      document.getElementById('hudLevel').textContent = 'Рівень: ' + level;
      document.getElementById('hudScore').textContent = 'Бонуси: ' + score;
      document.getElementById('timerValue').textContent = ('0'+timeLeft).slice(-2);
    }

    // --- Звук ---
    function tryPlayMusic() {
      if (musicOn && bgMusic.paused) {
        bgMusic.play().catch(()=>{});
      }
      document.getElementById('soundIcon').src = musicOn ? soundOnImg : soundOffImg;
    }
    document.getElementById('soundBtn').onclick = function() {
      musicOn = !musicOn;
      if (musicOn) {
        bgMusic.play();
      } else {
        bgMusic.pause();
      }
      document.getElementById('soundIcon').src = musicOn ? soundOnImg : soundOffImg;
    };

    // --- Таймер ---
    function startTimer() {
      if (timerInt) clearInterval(timerInt);
      timerInt = setInterval(()=>{
        timeLeft--;
        renderHUD();
        if (timeLeft<=0) finishLevel(false);
      }, 1000);
    }
    // --- Перевірка зіткнень ---
    function updateGame() {
      // Діна рух
      dina.x += dina.dx*dina.speed;
      dina.y += dina.dy*dina.speed;
      // Межі
      dina.x = Math.max(0, Math.min(W-dina.w*dina.scale, dina.x));
      dina.y = Math.max(0, Math.min(H-dina.h*dina.scale, dina.y));
      // Мушлі
      for (let sh of shells) {
        if (!sh.taken && Math.abs(dina.x-sh.x)<50 && Math.abs(dina.y-sh.y)<50) {
          sh.taken = true;
          score += 25;
          // Збільшення Діни (до 3x max)
          dina.scale = Math.min(dina.scale + 0.1, 3);
        }
      }
      // Перевірка яхти
      if (yacht.visible && Math.abs(dina.x-yacht.x)<60 && Math.abs(dina.y-yacht.y)<60) {
        // спецбонус
        score += 100;
        yacht.visible = false;
      }
      // Всі мушлі зібрано?
      if (shells.every(sh=>sh.taken)) finishLevel(true);
    }
    // --- Кінець рівня/гри ---
    function finishLevel(win) {
      stopDinaMove();
      if (timerInt) clearInterval(timerInt);
      if (animFrame) cancelAnimationFrame(animFrame);
      setTimeout(()=>{
        if (win) {
          level++;
          timeLeft = Math.max(30, 40 - level*2);
          // Швидкість яхти поступово
          dina.speed = Math.min(4.5, 3 + level*0.2);
        } else {
          level = 1; score = 0; timeLeft = 40; dina.scale = 1;
        }
        startGame();
        startTimer();
      }, 1000);
    }

    // --- Цикл оновлення (фізика) ---
    setInterval(updateGame, 30);

    // --- Запуск ---
    bgImg.onload = function() {
      startGame();
      startTimer();
    };
    renderHUD();

    // --- Автоматичне відтворення музики на мобільних при тапі ---
    window.addEventListener('touchend', ()=>{
      if (musicOn) tryPlayMusic();
    }, { once:true });

    // --- Запобігти скролу сторінки на мобільних ---
    document.body.addEventListener('touchmove', function(e) {
      e.preventDefault();
    }, { passive: false });
  </script>
</body>
</html>
